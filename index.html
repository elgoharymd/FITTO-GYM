<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FITTO GYM</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary-color: #4361ee;
            --primary-light: #e0e7ff;
            --secondary-color: #3f37c9;
            --success-color: #10b981;
            --success-light: #d1fae5;
            --danger-color: #ef4444;
            --danger-light: #fee2e2;
            --warning-color: #f59e0b;
            --warning-light: #fef3c7;
            --info-color: #3b82f6;
            --info-light: #dbeafe;
            --dark-color: #1f2937;
            --light-color: #f9fafb;
            --gray-color: #6b7280;
            --border-radius: 0.75rem;
            --box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
            --transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            --glow-effect: 0 0 15px rgba(67, 97, 238, 0.3);
            --profit-color: #7c3aed;
            --profit-light: #ede9fe;
            --daily-profit-color: #3a7bed;
            --daily-profit-light: #e9f4fe;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Tajawal', sans-serif;
            background-color: #f5f7fa;
            color: var(--dark-color);
            line-height: 1.6;
            scroll-behavior: smooth;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 1.5rem;
        }

        /* Header Styles */
        .header {
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            color: white;
            padding: 2rem;
            border-radius: var(--border-radius);
            margin-bottom: 2rem;
            box-shadow: var(--box-shadow);
            text-align: center;
            position: relative;
            overflow: hidden;
            animation: fadeInDown 0.8s ease;
        }

        .header::before {
            content: "";
            position: absolute;
            top: -10px;
            left: -10px;
            right: -10px;
            bottom: -10px;
            background: linear-gradient(135deg, 
                rgba(67, 97, 238, 0.8), 
                rgba(63, 55, 201, 0.8));
            z-index: -1;
            filter: blur(15px);
            border-radius: var(--border-radius);
        }

        .logo-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            margin-bottom: 1rem;
        }

        .logo {
            width: 120px;
            height: 120px;
            background-color: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.2);
            overflow: hidden;
            margin-bottom: 10px;
            position: relative;
            transition: var(--transition);
        }

        .logo:hover {
            transform: scale(1.05);
            box-shadow: 0 0 25px rgba(255, 255, 255, 0.4);
        }

        .logo::after {
            content: "";
            position: absolute;
            top: -5px;
            left: -5px;
            right: -5px;
            bottom: -5px;
            border-radius: 50%;
            border: 2px solid rgba(255, 255, 255, 0.8);
            animation: pulse 2s infinite;
            pointer-events: none;
        }

        .logo img {
            width: 100%;
            height: 100%;
            object-fit: contain;
            padding: 10px;
        }

        .club-name {
            font-size: 2rem;
            font-weight: 700;
            margin-top: 10px;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
        }

        .header h1 {
            font-size: 2rem;
            margin-bottom: 0.5rem;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
        }

        /* Button Styles */
        .btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            padding: 0.75rem 1.5rem;
            border: none;
            border-radius: var(--border-radius);
            background-color: var(--primary-color);
            color: white;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
            margin-bottom: 1.5rem;
            position: relative;
            overflow: hidden;
            box-shadow: 0 4px 10px rgba(67, 97, 238, 0.3);
        }

        .btn:hover {
            background-color: var(--secondary-color);
            transform: translateY(-2px);
            box-shadow: 0 8px 15px rgba(0, 0, 0, 0.2);
        }

        .btn:active {
            transform: translateY(0);
        }

        .btn::after {
            content: "";
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: rgba(255, 255, 255, 0.2);
            transform: rotate(45deg);
            transition: var(--transition);
            opacity: 0;
        }

        .btn:hover::after {
            opacity: 1;
            top: -20%;
            left: -20%;
        }

        .btn i {
            margin-left: 0.5rem;
        }

        .btn-sm {
            padding: 0.5rem 1rem;
            font-size: 0.875rem;
            min-width: 35px;
            height: 35px;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
        }

        .btn-sm i {
            margin: 0;
        }

        .btn-danger {
            background-color: var(--danger-color);
            box-shadow: 0 4px 10px rgba(239, 68, 68, 0.3);
        }

        .btn-danger:hover {
            background-color: #dc2626;
            box-shadow: 0 8px 15px rgba(239, 68, 68, 0.4);
        }

        .btn-warning {
            background-color: var(--warning-color);
            box-shadow: 0 4px 10px rgba(245, 158, 11, 0.3);
        }

        .btn-warning:hover {
            background-color: #d97706;
            box-shadow: 0 8px 15px rgba(245, 158, 11, 0.4);
        }

        .btn-success {
            background-color: var(--success-color);
            box-shadow: 0 4px 10px rgba(16, 185, 129, 0.3);
        }

        .btn-success:hover {
            background-color: #059669;
            box-shadow: 0 8px 15px rgba(16, 185, 129, 0.4);
        }

        .btn-info {
            background-color: var(--info-color);
            box-shadow: 0 4px 10px rgba(59, 130, 246, 0.3);
        }

        .btn-info:hover {
            background-color: #2563eb;
            box-shadow: 0 8px 15px rgba(59, 130, 246, 0.4);
        }

        .btn-profit {
            background-color: var(--profit-color);
            box-shadow: 0 4px 10px rgba(124, 58, 237, 0.3);
        }

        .btn-profit:hover {
            background-color: #6d28d9;
            box-shadow: 0 8px 15px rgba(124, 58, 237, 0.4);
        }

        .btn-daily-profit {
            background-color: var(--daily-profit-color);
            box-shadow: 0 4px 10px rgba(58, 123, 237, 0.3);
        }

        .btn-daily-profit:hover {
            background-color: #2563eb;
            box-shadow: 0 8px 15px rgba(58, 123, 237, 0.4);
        }

        .btn-light {
            background-color: var(--light-color);
            color: var(--dark-color);
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
        }

        .btn-light:hover {
            background-color: #e5e7eb;
            box-shadow: 0 8px 15px rgba(0, 0, 0, 0.15);
        }

        .btn-outline {
            background-color: transparent;
            border: 2px solid var(--primary-color);
            color: var(--primary-color);
            box-shadow: none;
        }

        .btn-outline:hover {
            background-color: var(--primary-color);
            color: white;
        }

        /* Form Section */
        .form-section {
            background-color: white;
            border-radius: var(--border-radius);
            padding: 2rem;
            margin-bottom: 2rem;
            box-shadow: var(--box-shadow);
            transition: all 0.5s ease;
            opacity: 0;
            max-height: 0;
            overflow: hidden;
            position: relative;
        }

        .form-section.active {
            max-height: 2000px;
            opacity: 1;
            margin-bottom: 2rem;
            overflow: visible;
            animation: fadeInUp 0.5s ease;
        }

        .form-section::before {
            content: "";
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 5px;
            background: linear-gradient(90deg, 
                var(--success-color), 
                var(--primary-color));
            box-shadow: 0 2px 5px rgba(76, 201, 240, 0.5);
            border-radius: var(--border-radius) var(--border-radius) 0 0;
        }

        .form-section h2 {
            color: var(--primary-color);
            margin-bottom: 1.5rem;
            padding-bottom: 0.5rem;
            border-bottom: 2px solid #eee;
            text-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .form-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 1.5rem;
            max-height: 500px;
            overflow-y: auto;
            padding: 10px;
        }

        .form-group {
            margin-bottom: 1rem;
            position: relative;
        }

        .form-group label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 600;
            color: var(--dark-color);
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .form-control {
            width: 100%;
            padding: 0.75rem 1rem;
            border: 1px solid #e5e7eb;
            border-radius: var(--border-radius);
            font-size: 1rem;
            transition: var(--transition);
            font-family: 'Tajawal', sans-serif;
            box-shadow: inset 0 1px 3px rgba(0, 0, 0, 0.05);
            background-color: var(--light-color);
        }

        .form-control:focus {
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(67, 97, 238, 0.2), inset 0 1px 3px rgba(0, 0, 0, 0.05);
            outline: none;
            background-color: white;
        }

        textarea.form-control {
            min-height: 100px;
            resize: vertical;
        }

        /* Search Box */
        .search-container {
            margin-bottom: 1.5rem;
            position: relative;
        }

        .search-box {
            width: 100%;
            padding: 0.75rem 1.5rem 0.75rem 3rem;
            border: 1px solid #e5e7eb;
            border-radius: var(--border-radius);
            font-size: 1rem;
            transition: var(--transition);
            box-shadow: var(--box-shadow);
            background-color: var(--light-color);
        }

        .search-box:focus {
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(67, 97, 238, 0.2);
            outline: none;
            background-color: white;
        }

        .search-icon {
            position: absolute;
            top: 50%;
            right: 1rem;
            transform: translateY(-50%);
            color: var(--gray-color);
        }

        /* Accordion Styles */
        .accordion {
            margin-bottom: 2rem;
            border-radius: var(--border-radius);
            overflow: hidden;
            box-shadow: var(--box-shadow);
        }

        .accordion-item {
            background-color: white;
            border-bottom: 1px solid #e5e7eb;
        }

        .accordion-item:last-child {
            border-bottom: none;
        }

        .accordion-header {
            padding: 1.25rem 1.5rem;
            background-color: var(--light-color);
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: var(--transition);
        }

        .accordion-header:hover {
            background-color: #f3f4f6;
        }

        .accordion-header.active {
            background-color: var(--primary-light);
        }

        .accordion-title {
            font-weight: 600;
            color: var(--dark-color);
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }

        .accordion-icon {
            transition: var(--transition);
        }

        .accordion-header.active .accordion-icon {
            transform: rotate(180deg);
        }

        .accordion-content {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.3s ease;
        }

        .accordion-content-inner {
            padding: 1.5rem;
        }

        /* Table Section */
        .table-section {
            background-color: white;
            border-radius: var(--border-radius);
            box-shadow: var(--box-shadow);
            overflow: hidden;
            margin-bottom: 2rem;
            position: relative;
            animation: fadeIn 0.6s ease;
        }

        .table-section::before {
            content: "";
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 5px;
            background: linear-gradient(90deg, 
                var(--primary-color), 
                var(--secondary-color));
            box-shadow: 0 2px 5px rgba(67, 97, 238, 0.5);
        }

        .table-section h2 {
            color: var(--primary-color);
            margin-bottom: 1.5rem;
            text-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .table-responsive {
            overflow-x: auto;
            -webkit-overflow-scrolling: touch;
            max-height: 600px;
            overflow-y: auto;
        }

        .members-table {
            width: 100%;
            border-collapse: collapse;
            min-width: 800px;
        }

        .members-table th,
        .members-table td {
            padding: 1rem;
            text-align: center;
            border-bottom: 1px solid #f3f4f6;
        }

        .members-table th {
            background-color: #f9fafb;
            font-weight: 700;
            color: var(--dark-color);
            position: sticky;
            top: 0;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.05);
        }

        .members-table tr {
            transition: var(--transition);
            position: relative;
        }

        .members-table tr:hover {
            background-color: #f9fafb;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
            z-index: 1;
        }

        /* Status Styles */
        .status {
            display: inline-flex;
            align-items: center;
            padding: 0.25rem 0.75rem;
            border-radius: 1rem;
            font-size: 0.875rem;
            font-weight: 600;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.05);
        }

        .status-active {
            background-color: var(--success-light);
            color: var(--success-color);
        }

        .status-expired {
            background-color: var(--danger-light);
            color: var(--danger-color);
        }

        .status-paid {
            background-color: var(--success-light);
            color: var(--success-color);
        }

        .status-unpaid {
            background-color: var(--danger-light);
            color: var(--danger-color);
        }

        .status-icon {
            margin-left: 0.5rem;
            font-size: 0.875rem;
        }

        /* Amount Styles */
        .amount {
            font-weight: 600;
        }

        .amount-remaining {
            color: var(--success-color);
        }

        .amount-due {
            color: var(--danger-color);
        }

        /* Stats Cards */
        .stats-section {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2rem;
            animation: fadeIn 0.6s ease;
        }

        .stat-card {
            background-color: white;
            border-radius: var(--border-radius);
            padding: 1.5rem;
            box-shadow: var(--box-shadow);
            text-align: center;
            position: relative;
            overflow: hidden;
            transition: var(--transition);
        }

        .stat-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
        }

        .stat-card.active-members:hover {
            box-shadow: 0 0 20px rgba(16, 185, 129, 0.2);
        }

        .stat-card.expired-members:hover {
            box-shadow: 0 0 20px rgba(239, 68, 68, 0.2);
        }

        .stat-card.profit-card:hover {
            box-shadow: 0 0 20px rgba(124, 58, 237, 0.2);
        }

        .stat-card.daily-profit-card:hover {
            box-shadow: 0 0 20px rgba(58, 123, 237, 0.2);
        }

        .stat-card::before {
            content: "";
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 5px;
            background: var(--primary-color);
            box-shadow: 0 2px 5px rgba(67, 97, 238, 0.5);
        }

        .stat-card.active-members::before {
            background: var(--success-color);
            box-shadow: 0 2px 5px rgba(16, 185, 129, 0.5);
        }

        .stat-card.expired-members::before {
            background: var(--danger-color);
            box-shadow: 0 2px 5px rgba(239, 68, 68, 0.5);
        }

        .stat-card.profit-card::before {
            background: var(--profit-color);
            box-shadow: 0 2px 5px rgba(124, 58, 237, 0.5);
        }

        .stat-card.daily-profit-card::before {
            background: var(--daily-profit-color);
            box-shadow: 0 2px 5px rgba(58, 123, 237, 0.5);
        }

        .stat-title {
            font-size: 1rem;
            color: var(--gray-color);
            margin-bottom: 0.5rem;
        }

        .stat-value {
            font-size: 2rem;
            font-weight: 700;
            margin-bottom: 0.5rem;
        }

        .stat-card.active-members .stat-value {
            color: var(--success-color);
        }

        .stat-card.expired-members .stat-value {
            color: var(--danger-color);
        }

        .stat-card.profit-card .stat-value {
            color: var(--profit-color);
        }

        .stat-card.daily-profit-card .stat-value {
            color: var(--daily-profit-color);
        }

        .stat-change {
            font-size: 0.875rem;
            color: var(--gray-color);
        }

        /* Tabs */
        .tabs {
            display: flex;
            margin-bottom: 1.5rem;
            border-bottom: 1px solid #e5e7eb;
            background-color: white;
            border-radius: var(--border-radius) var(--border-radius) 0 0;
            overflow: hidden;
        }

        .tab {
            padding: 1rem 1.5rem;
            cursor: pointer;
            font-weight: 600;
            color: var(--gray-color);
            border-bottom: 3px solid transparent;
            transition: var(--transition);
            position: relative;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .tab:hover {
            color: var(--primary-color);
            background-color: var(--primary-light);
        }

        .tab.active {
            color: var(--primary-color);
            border-bottom-color: var(--primary-color);
            background-color: var(--primary-light);
        }

        .tab::after {
            content: "";
            position: absolute;
            bottom: -3px;
            left: 0;
            right: 0;
            height: 3px;
            background: var(--primary-color);
            transform: scaleX(0);
            transition: var(--transition);
        }

        .tab:hover::after {
            transform: scaleX(1);
        }

        .tab.active::after {
            transform: scaleX(1);
        }

        .tab-content {
            display: none;
            animation: fadeIn 0.5s ease;
        }

        .tab-content.active {
            display: block;
        }

        /* Action Buttons */
        .action-buttons {
            display: flex;
            gap: 0.5rem;
            justify-content: center;
        }

        /* Toast Notification */
        .toast {
            position: fixed;
            top: 20px;
            right: 20px;
            background-color: var(--success-color);
            color: white;
            padding: 1rem 1.5rem;
            border-radius: var(--border-radius);
            box-shadow: var(--box-shadow);
            z-index: 1000;
            display: flex;
            align-items: center;
            transform: translateX(150%);
            transition: transform 0.3s ease;
        }

        .toast.show {
            transform: translateX(0);
        }

        .toast i {
            margin-left: 0.5rem;
        }

        .toast.error {
            background-color: var(--danger-color);
        }

        .toast.warning {
            background-color: var(--warning-color);
        }

        /* Loading Spinner */
        .spinner {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(255,255,255,.3);
            border-radius: 50%;
            border-top-color: white;
            animation: spin 1s ease-in-out infinite;
            margin-right: 10px;
        }

        /* Dropdown Menu */
        .dropdown {
            position: relative;
            display: inline-block;
        }

        .dropdown-toggle {
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .dropdown-menu {
            position: absolute;
            top: 100%;
            right: 0;
            background-color: white;
            min-width: 200px;
            border-radius: var(--border-radius);
            box-shadow: var(--box-shadow);
            z-index: 100;
            opacity: 0;
            visibility: hidden;
            transform: translateY(10px);
            transition: all 0.3s ease;
        }

        .dropdown-menu.show {
            opacity: 1;
            visibility: visible;
            transform: translateY(0);
        }

        .dropdown-item {
            padding: 0.75rem 1rem;
            cursor: pointer;
            transition: var(--transition);
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }

        .dropdown-item:hover {
            background-color: var(--light-color);
        }

        .dropdown-divider {
            height: 1px;
            background-color: #e5e7eb;
            margin: 0.25rem 0;
        }

        /* Payments Section */
        .payments-section {
            background-color: white;
            border-radius: var(--border-radius);
            padding: 1.5rem;
            margin-bottom: 2rem;
            box-shadow: var(--box-shadow);
        }

        .payments-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
        }

        .payments-title {
            color: var(--primary-color);
            font-size: 1.25rem;
            font-weight: 700;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .payments-table {
            width: 100%;
            border-collapse: collapse;
        }

        .payments-table th,
        .payments-table td {
            padding: 0.75rem;
            text-align: center;
            border-bottom: 1px solid #f3f4f6;
        }

        .payments-table th {
            background-color: #f9fafb;
            font-weight: 700;
            color: var(--dark-color);
            position: sticky;
            top: 0;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.05);
        }

        .payments-table tr:hover {
            background-color: #f9fafb;
        }

        /* Animations */
        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        @keyframes pulse {
            0% { transform: scale(0.95); opacity: 0.7; }
            50% { transform: scale(1.05); opacity: 1; }
            100% { transform: scale(0.95); opacity: 0.7; }
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        @keyframes fadeInUp {
            from { 
                opacity: 0;
                transform: translateY(20px);
            }
            to { 
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes fadeInDown {
            from { 
                opacity: 0;
                transform: translateY(-20px);
            }
            to { 
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes glow {
            0% { box-shadow: 0 0 5px rgba(67, 97, 238, 0.3); }
            50% { box-shadow: 0 0 20px rgba(67, 97, 238, 0.5); }
            100% { box-shadow: 0 0 5px rgba(67, 97, 238, 0.3); }
        }

        .fade-in {
            animation: fadeIn 0.5s ease forwards;
        }

        .glowing {
            animation: glow 2s infinite;
        }

        /* Responsive Adjustments */
        @media (max-width: 768px) {
            .header h1 {
                font-size: 1.5rem;
            }
            
            .club-name {
                font-size: 1.4rem;
            }
            
            .logo {
                width: 100px;
                height: 100px;
            }
            
            .btn {
                padding: 0.6rem 1rem;
                font-size: 0.875rem;
            }
            
            .form-section {
                padding: 1.5rem;
            }
            
            .members-table th,
            .members-table td {
                padding: 0.75rem;
                font-size: 0.875rem;
            }
            
            .stats-section {
                grid-template-columns: 1fr;
            }
        }

        @media (max-width: 480px) {
            .form-grid {
                grid-template-columns: 1fr;
            }
            
            .header {
                padding: 1rem;
            }
            
            .container {
                padding: 0.75rem;
            }
            
            .tabs {
                overflow-x: auto;
                white-space: nowrap;
                padding-bottom: 5px;
            }
            
            .tab {
                padding: 0.75rem 1rem;
                font-size: 0.875rem;
            }
            
            .action-buttons {
                flex-direction: column;
                align-items: center;
                gap: 0.25rem;
            }
            
            .btn-sm {
                width: 100%;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header class="header">
            <div class="logo-container">
                <div class="logo glowing">
                    <img src="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEjneSenlewCewrAJE5xFQM0S3t46_lNzhbbi6TMsAwo4wQ8K0VSZeVAWobEmJkeFjj1zLf__qaoXhO2Vnc4-F6nhcSpnvP08FxfY0NjRlSKb12RG3gZfCzQUYfQEhyphenhyphen6JkBn36ck3QVBKv5yV3LCNo79164KauMIL8UOUhBjVfRAi1-202KpjlYNBOlmvOLC/s1080/IMG-20250810-WA0001.jpg" alt="شعار النادي" id="clubLogo">
                </div>
                <div class="club-name">FITTO GYM</div>
            </div>
            <h1>نظام إدارة المشتركين</h1>
            <p>إدارة كاملة لأعضاء النادي وتتبع الاشتراكات والأرباح</p>
        </header>

        <!-- إحصائيات المشتركين -->
        <div class="stats-section">
            <div class="stat-card active-members">
                <h3 class="stat-title">المشتركين النشطين</h3>
                <div class="stat-value" id="activeMembersCount">0</div>
                <div class="stat-change">اشتراكات سارية المفعول</div>
            </div>
            <div class="stat-card expired-members">
                <h3 class="stat-title">المشتركين المنتهية اشتراكاتهم</h3>
                <div class="stat-value" id="expiredMembersCount">0</div>
                <div class="stat-change">بحاجة إلى تجديد</div>
            </div>
            <div class="stat-card profit-card">
                <h3 class="stat-title">إجمالي الأرباح</h3>
                <div class="stat-value" id="totalProfit">0 E.G</div>
                <div class="stat-change">إجمالي المبالغ المحصلة</div>
            </div>
            <div class="stat-card daily-profit-card">
                <h3 class="stat-title">الأرباح اليومية</h3>
                <div class="stat-value" id="dailyProfit">0 E.G</div>
                <div class="stat-change">المبالغ المحصلة اليوم</div>
            </div>
        </div>

        <div class="action-buttons" style="justify-content: flex-start; margin-bottom: 1.5rem;">
            <button id="toggleFormBtn" class="btn">
                <i class="fas fa-user-plus"></i> إضافة عضو جديد
            </button>
            <button id="addDailyProfitBtn" class="btn btn-daily-profit">
                <i class="fas fa-plus-circle"></i> إضافة ربح يومي
            </button>
            <button id="saveDailyProfitBtn" class="btn btn-success" style="display: none;">
                <i class="fas fa-save"></i> حفظ الربح اليومي
            </button>
            <button id="backupBtn" class="btn btn-info">
                <i class="fas fa-database"></i> نسخ احتياطي
            </button>
            <button id="recalculateBtn" class="btn btn-warning">
                <i class="fas fa-calculator"></i> إعادة حساب الأموال
            </button>
            <button id="clearPaymentsBtn" class="btn btn-danger">
                <i class="fas fa-trash"></i> حذف جميع الأموال
            </button>
        </div>

        <!-- نموذج إضافة عضو جديد -->
        <section id="addMemberSection" class="form-section">
            <h2><i class="fas fa-user-edit"></i> نموذج إدارة العضو</h2>
            <form id="memberForm" class="form-grid">
                <input type="hidden" id="memberId">
                
                <div class="form-group">
                    <label for="memberName"><i class="fas fa-user"></i> اسم العضو</label>
                    <input type="text" id="memberName" class="form-control" required>
                </div>
                
                <div class="form-group">
                    <label for="phoneNumber"><i class="fas fa-phone"></i> رقم الهاتف</label>
                    <input type="tel" id="phoneNumber" class="form-control" required>
                </div>
                
                <div class="form-group">
                    <label for="subscriptionMonths"><i class="fas fa-calendar-alt"></i> مدة الاشتراك (شهور)</label>
                    <select id="subscriptionMonths" class="form-control" required>
                        <option value="1">1 شهر</option>
                        <option value="2">2 شهر</option>
                        <option value="3">3 شهور</option>
                        <option value="4">4 شهور</option>
                        <option value="5">5 شهور</option>
                        <option value="6">6 شهور</option>
                        <option value="7">7 شهور</option>
                        <option value="8">8 شهور</option>
                        <option value="9">9 شهور</option>
                        <option value="10">10 شهور</option>
                        <option value="11">11 شهر</option>
                        <option value="12">12 شهر (سنة)</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label for="startDate"><i class="fas fa-calendar-alt"></i> تاريخ بداية الاشتراك</label>
                    <input type="date" id="startDate" class="form-control" required>
                </div>
                
                <div class="form-group">
                    <label for="endDate"><i class="fas fa-calendar-times"></i> تاريخ نهاية الاشتراك</label>
                    <input type="date" id="endDate" class="form-control" required readonly>
                </div>
                
                <div class="form-group">
                    <label for="subscriptionFee"><i class="fas fa-money-bill-wave"></i> رسوم الاشتراك الكاملة</label>
                    <input type="number" id="subscriptionFee" class="form-control" required min="0" step="any">
                </div>
                
                <div class="form-group">
                    <label for="amountPaid"><i class="fas fa-hand-holding-usd"></i> المبلغ المدفوع</label>
                    <input type="number" id="amountPaid" class="form-control" required min="0" step="any">
                </div>
                
                <div class="form-group">
                    <label for="paymentStatus"><i class="fas fa-check-circle"></i> حالة الدفع</label>
                    <select id="paymentStatus" class="form-control" required>
                        <option value="paid">مسدد</option>
                        <option value="unpaid">غير مسدد</option>
                    </select>
                </div>
                
                <div class="form-group" style="grid-column: 1 / -1;">
                    <label for="notes"><i class="fas fa-sticky-note"></i> ملاحظات (اختياري)</label>
                    <textarea id="notes" class="form-control" placeholder="أي ملاحظات إضافية عن المشترك..."></textarea>
                </div>
                
                <div class="form-group" style="grid-column: 1 / -1;">
                    <button type="submit" class="btn" id="submitBtn" style="width: 100%;">
                        <i class="fas fa-save"></i> حفظ العضو
                    </button>
                </div>
                
                <div class="form-group" style="grid-column: 1 / -1; display: none;" id="cancelEditDiv">
                    <button type="button" class="btn btn-warning" id="cancelEditBtn" style="width: 100%;">
                        <i class="fas fa-times"></i> إلغاء التعديل
                    </button>
                </div>
            </form>
        </section>

        <!-- نموذج إضافة ربح يومي -->
        <section id="dailyProfitSection" class="form-section" style="display: none;">
            <h2><i class="fas fa-coins"></i> إضافة ربح يومي</h2>
            <form id="dailyProfitForm" class="form-grid">
                <div class="form-group">
                    <label for="dailyProfitDate"><i class="fas fa-calendar-day"></i> التاريخ</label>
                    <input type="date" id="dailyProfitDate" class="form-control" required>
                </div>
                
                <div class="form-group">
                    <label for="dailyProfitAmount"><i class="fas fa-money-bill-wave"></i> المبلغ</label>
                    <input type="number" id="dailyProfitAmount" class="form-control" required min="0" step="any">
                </div>
                
                <div class="form-group">
                    <label for="dailyProfitSource"><i class="fas fa-tags"></i> المصدر</label>
                    <input type="text" id="dailyProfitSource" class="form-control" placeholder="مثال: اشتراكات جديدة، تجديدات، إلخ...">
                </div>
                
                <div class="form-group" style="grid-column: 1 / -1;">
                    <label for="dailyProfitNotes"><i class="fas fa-sticky-note"></i> ملاحظات (اختياري)</label>
                    <textarea id="dailyProfitNotes" class="form-control" placeholder="أي ملاحظات إضافية عن الربح اليومي..."></textarea>
                </div>
                
                <div class="form-group" style="grid-column: 1 / -1;">
                    <button type="submit" class="btn btn-daily-profit" id="submitDailyProfitBtn" style="width: 100%;">
                        <i class="fas fa-save"></i> حفظ الربح اليومي
                    </button>
                </div>
                
                <div class="form-group" style="grid-column: 1 / -1;">
                    <button type="button" class="btn btn-warning" id="cancelDailyProfitBtn" style="width: 100%;">
                        <i class="fas fa-times"></i> إلغاء
                    </button>
                </div>
            </form>
        </section>
        
        <!-- قسم المدفوعات -->
        <div class="accordion">
            <div class="accordion-item">
                <div class="accordion-header" id="paymentsHeader">
                    <div class="accordion-title">
                        <i class="fas fa-money-bill-wave"></i>
                        <span>إدارة المدفوعات</span>
                    </div>
                    <div class="accordion-icon">
                        <i class="fas fa-chevron-down"></i>
                    </div>
                </div>
                <div class="accordion-content" id="paymentsContent">
                    <div class="accordion-content-inner">
                        <div class="payments-section">
                            <div class="payments-header">
                                <h3 class="payments-title">
                                    <i class="fas fa-coins"></i>
                                    <span>سجل المدفوعات</span>
                                </h3>
                            </div>
                            
                            <div class="table-responsive">
                                <table class="payments-table">
                                    <thead>
                                        <tr>
                                            <th>اسم العضو</th>
                                            <th>رقم الهاتف</th>
                                            <th>التاريخ</th>
                                            <th>المبلغ</th>
                                            <th>حالة الدفع</th>
                                            <th>ملاحظات</th>
                                        </tr>
                                    </thead>
                                    <tbody id="paymentsList">
                                        <!-- سيتم ملء هذا القسم بالبيانات من Firebase -->
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- قوائم المشتركين -->
        <div class="accordion">
            <div class="accordion-item">
                <div class="accordion-header" id="membersHeader">
                    <div class="accordion-title">
                        <i class="fas fa-users"></i>
                        <span>إدارة المشتركين</span>
                    </div>
                    <div class="accordion-icon">
                        <i class="fas fa-chevron-down"></i>
                    </div>
                </div>
                <div class="accordion-content" id="membersContent">
                    <div class="accordion-content-inner">
                        <div class="tabs">
                            <div class="tab active" data-tab="all">
                                <i class="fas fa-users"></i>
                                <span>جميع المشتركين</span>
                            </div>
                            <div class="tab" data-tab="active">
                                <i class="fas fa-user-check"></i>
                                <span>المشتركين النشطين</span>
                            </div>
                            <div class="tab" data-tab="expired">
                                <i class="fas fa-user-clock"></i>
                                <span>الاشتراكات المنتهية</span>
                            </div>
                        </div>
                        
                        <!-- صندوق البحث -->
                        <div class="search-container">
                            <i class="fas fa-search search-icon"></i>
                            <input type="text" id="searchInput" class="search-box" placeholder="ابحث عن مشترك بالاسم أو رقم الهاتف...">
                        </div>
                        
                        <div class="tab-content active" id="all-members">
                            <div class="table-responsive">
                                <table class="members-table">
                                    <thead>
                                        <tr>
                                            <th>اسم العضو</th>
                                            <th>رقم الهاتف</th>
                                            <th>بداية الاشتراك</th>
                                            <th>نهاية الاشتراك</th>
                                            <th>حالة الاشتراك</th>
                                            <th>حالة الدفع</th>
                                            <th>المبلغ المدفوع</th>
                                            <th>المبلغ المتبقي</th>
                                            <th>الإجراءات</th>
                                        </tr>
                                    </thead>
                                    <tbody id="membersList">
                                        <!-- سيتم ملء هذا القسم بالبيانات من Firebase -->
                                    </tbody>
                                </table>
                            </div>
                        </div>
                        
                        <div class="tab-content" id="active-members">
                            <div class="table-responsive">
                                <table class="members-table">
                                    <thead>
                                        <tr>
                                            <th>اسم العضو</th>
                                            <th>رقم الهاتف</th>
                                            <th>بداية الاشتراك</th>
                                            <th>نهاية الاشتراك</th>
                                            <th>حالة الدفع</th>
                                            <th>المبلغ المدفوع</th>
                                            <th>المبلغ المتبقي</th>
                                            <th>الإجراءات</th>
                                        </tr>
                                    </thead>
                                    <tbody id="activeMembersList">
                                        <!-- سيتم ملء هذا القسم بالبيانات من Firebase -->
                                    </tbody>
                                </table>
                            </div>
                        </div>
                        
                        <div class="tab-content" id="expired-members">
                            <div class="table-responsive">
                                <table class="members-table">
                                    <thead>
                                        <tr>
                                            <th>اسم العضو</th>
                                            <th>رقم الهاتف</th>
                                            <th>بداية الاشتراك</th>
                                            <th>نهاية الاشتراك</th>
                                            <th>حالة الدفع</th>
                                            <th>المبلغ المدفوع</th>
                                            <th>المبلغ المتبقي</th>
                                            <th>الإجراءات</th>
                                        </tr>
                                    </thead>
                                    <tbody id="expiredMembersList">
                                        <!-- سيتم ملء هذا القسم بالبيانات من Firebase -->
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Toast Notification -->
    <div id="toast" class="toast">
        <i class="fas fa-check-circle"></i>
        <span id="toast-message">تمت العملية بنجاح</span>
    </div>

    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-analytics.js"></script>

    <script>
        // Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyBMJe0CVmxCrFthFmJEs5W_p1x3AFpFmHQ",
            authDomain: "moaz-a8190.firebaseapp.com",
            databaseURL: "https://moaz-a8190-default-rtdb.firebaseio.com",
            projectId: "moaz-a8190",
            storageBucket: "moaz-a8190.appspot.com",
            messagingSenderId: "839870478124",
            appId: "1:839870478124:web:904d5776d12a406e179e89",
            measurementId: "G-9S19GW5E26"
        };

        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        firebase.analytics();
        
        // Initialize Realtime Database
        const database = firebase.database();
        const membersRef = database.ref('members');
        const paymentsRef = database.ref('payments');
        const dailyProfitsRef = database.ref('dailyProfits');
        const backupRef = database.ref('backups');

        // DOM elements
        const toggleFormBtn = document.getElementById('toggleFormBtn');
        const addMemberSection = document.getElementById('addMemberSection');
        const memberForm = document.getElementById('memberForm');
        const membersList = document.getElementById('membersList');
        const activeMembersList = document.getElementById('activeMembersList');
        const expiredMembersList = document.getElementById('expiredMembersList');
        const paymentsList = document.getElementById('paymentsList');
        const activeMembersCount = document.getElementById('activeMembersCount');
        const expiredMembersCount = document.getElementById('expiredMembersCount');
        const totalProfit = document.getElementById('totalProfit');
        const dailyProfitEl = document.getElementById('dailyProfit');
        const subscriptionMonths = document.getElementById('subscriptionMonths');
        const startDateInput = document.getElementById('startDate');
        const endDateInput = document.getElementById('endDate');
        const subscriptionFeeInput = document.getElementById('subscriptionFee');
        const amountPaidInput = document.getElementById('amountPaid');
        const submitBtn = document.getElementById('submitBtn');
        const cancelEditBtn = document.getElementById('cancelEditBtn');
        const cancelEditDiv = document.getElementById('cancelEditDiv');
        const memberIdInput = document.getElementById('memberId');
        const tabs = document.querySelectorAll('.tab');
        const tabContents = document.querySelectorAll('.tab-content');
        const toast = document.getElementById('toast');
        const toastMessage = document.getElementById('toast-message');
        const clubLogo = document.getElementById('clubLogo');
        const searchInput = document.getElementById('searchInput');
        const paymentsHeader = document.getElementById('paymentsHeader');
        const paymentsContent = document.getElementById('paymentsContent');
        const addDailyProfitBtn = document.getElementById('addDailyProfitBtn');
        const saveDailyProfitBtn = document.getElementById('saveDailyProfitBtn');
        const dailyProfitSection = document.getElementById('dailyProfitSection');
        const dailyProfitForm = document.getElementById('dailyProfitForm');
        const dailyProfitDate = document.getElementById('dailyProfitDate');
        const dailyProfitAmount = document.getElementById('dailyProfitAmount');
        const dailyProfitSource = document.getElementById('dailyProfitSource');
        const dailyProfitNotes = document.getElementById('dailyProfitNotes');
        const submitDailyProfitBtn = document.getElementById('submitDailyProfitBtn');
        const cancelDailyProfitBtn = document.getElementById('cancelDailyProfitBtn');
        const backupBtn = document.getElementById('backupBtn');
        const recalculateBtn = document.getElementById('recalculateBtn');
        const clearPaymentsBtn = document.getElementById('clearPaymentsBtn');

        // متغيرات التطبيق
        let isEditMode = false;
        let currentMemberId = null;
        let allMembers = [];
        let allPayments = [];
        let dailyProfits = [];
        let totalProfitAmount = 0;
        let dailyProfitTotal = 0;
        let backupInterval;
        let profitCheckInterval;

        // Accordion functionality
        paymentsHeader.addEventListener('click', () => {
            paymentsHeader.classList.toggle('active');
            const content = paymentsContent;
            if (content.style.maxHeight) {
                content.style.maxHeight = null;
            } else {
                content.style.maxHeight = content.scrollHeight + "px";
            }
        });

        membersHeader.addEventListener('click', () => {
            membersHeader.classList.toggle('active');
            const content = membersContent;
            if (content.style.maxHeight) {
                content.style.maxHeight = null;
            } else {
                content.style.maxHeight = content.scrollHeight + "px";
            }
        });

        // Open members accordion by default
        membersHeader.classList.add('active');
        membersContent.style.maxHeight = membersContent.scrollHeight + "px";

        // عرض/إخفاء نموذج الإضافة
        toggleFormBtn.addEventListener('click', function() {
            addMemberSection.classList.toggle('active');
            
            if (addMemberSection.classList.contains('active')) {
                toggleFormBtn.innerHTML = '<i class="fas fa-times"></i> إغلاق النموذج';
                addMemberSection.scrollIntoView({ behavior: 'smooth', block: 'start' });
            } else {
                toggleFormBtn.innerHTML = '<i class="fas fa-user-plus"></i> إضافة عضو جديد';
                cancelEdit();
            }
        });

        // عرض/إخفاء نموذج الربح اليومي
        addDailyProfitBtn.addEventListener('click', function() {
            dailyProfitSection.style.display = 'block';
            dailyProfitSection.classList.add('active');
            addDailyProfitBtn.style.display = 'none';
            saveDailyProfitBtn.style.display = 'inline-flex';
            
            // تعيين تاريخ اليوم كقيمة افتراضية
            const today = new Date().toISOString().split('T')[0];
            dailyProfitDate.value = today;
            
            dailyProfitSection.scrollIntoView({ behavior: 'smooth', block: 'start' });
        });

        saveDailyProfitBtn.addEventListener('click', function() {
            dailyProfitSection.style.display = 'none';
            dailyProfitSection.classList.remove('active');
            addDailyProfitBtn.style.display = 'inline-flex';
            saveDailyProfitBtn.style.display = 'none';
        });

        cancelDailyProfitBtn.addEventListener('click', function() {
            dailyProfitSection.style.display = 'none';
            dailyProfitSection.classList.remove('active');
            addDailyProfitBtn.style.display = 'inline-flex';
            saveDailyProfitBtn.style.display = 'none';
            dailyProfitForm.reset();
        });

        // حساب تاريخ نهاية الاشتراك عند تغيير تاريخ البدء أو عدد الأشهر
        function calculateEndDate() {
            const months = parseInt(subscriptionMonths.value);
            const startDate = new Date(startDateInput.value);
            
            if (!isNaN(startDate.getTime())) {
                const endDate = new Date(startDate);
                endDate.setMonth(startDate.getMonth() + months);
                endDateInput.value = endDate.toISOString().split('T')[0];
            }
        }

        // استماع لتغيير تاريخ البدء أو عدد الأشهر
        startDateInput.addEventListener('change', calculateEndDate);
        subscriptionMonths.addEventListener('change', calculateEndDate);

        // التحقق من أن المبلغ المدفوع لا يتجاوز رسوم الاشتراك
        amountPaidInput.addEventListener('input', function() {
            const subscriptionFee = parseFloat(subscriptionFeeInput.value) || 0;
            const amountPaid = parseFloat(this.value) || 0;
            
            if (amountPaid > subscriptionFee) {
                this.value = subscriptionFee;
                showToast('المبلغ المدفوع لا يمكن أن يتجاوز رسوم الاشتراك', 'warning');
            }
        });

        // عرض رسالة Toast
        function showToast(message, type = 'success') {
            toastMessage.textContent = message;
            toast.className = 'toast show';
            
            if (type === 'error') {
                toast.classList.add('error');
            } else if (type === 'warning') {
                toast.classList.add('warning');
            } else {
                toast.classList.remove('error', 'warning');
            }
            
            setTimeout(() => {
                toast.classList.remove('show');
            }, 3000);
        }

        // إضافة/تعديل عضو
        memberForm.addEventListener('submit', function(e) {
            e.preventDefault();
            
            const name = document.getElementById('memberName').value.trim();
            const phone = document.getElementById('phoneNumber').value.trim();
            const startDate = startDateInput.value;
            const endDate = endDateInput.value;
            const subscriptionFee = parseFloat(subscriptionFeeInput.value);
            const amountPaid = parseFloat(document.getElementById('amountPaid').value) || 0;
            const paymentStatus = document.getElementById('paymentStatus').value;
            const notes = document.getElementById('notes').value.trim();
            
            if (!name || !phone || !startDate || !endDate || isNaN(subscriptionFee)) {
                showToast('الرجاء تعبئة جميع الحقول المطلوبة', 'error');
                return;
            }
            
            if (amountPaid > subscriptionFee) {
                showToast('المبلغ المدفوع لا يمكن أن يتجاوز رسوم الاشتراك', 'error');
                return;
            }
            
            const memberData = {
                name: name,
                phone: phone,
                startDate: startDate,
                endDate: endDate,
                subscriptionFee: subscriptionFee,
                amountPaid: amountPaid,
                paymentStatus: paymentStatus,
                notes: notes,
                updatedAt: firebase.database.ServerValue.TIMESTAMP
            };
            
            submitBtn.innerHTML = '<div class="spinner"></div> جاري الحفظ...';
            submitBtn.disabled = true;
            
            if (isEditMode) {
                membersRef.child(currentMemberId).update(memberData)
                    .then(() => {
                        showToast('تم تعديل بيانات العضو بنجاح');
                        resetForm();
                    })
                    .catch(error => {
                        showToast('حدث خطأ أثناء تعديل العضو: ' + error.message, 'error');
                    })
                    .finally(() => {
                        submitBtn.innerHTML = '<i class="fas fa-save"></i> حفظ التعديلات';
                        submitBtn.disabled = false;
                    });
            } else {
                membersRef.push({
                    ...memberData,
                    createdAt: firebase.database.ServerValue.TIMESTAMP
                })
                .then((ref) => {
                    showToast('تم إضافة العضو الجديد بنجاح');
                    resetForm();
                    
                    if (amountPaid > 0) {
                        recordPayment(ref.key, name, phone, amountPaid, 'دفعة اشتراك جديدة', notes);
                    }
                    
                    // تحديث الربح اليومي عند إضافة عضو جديد مع دفعة
                    if (amountPaid > 0) {
                        updateDailyProfit(amountPaid, 'اشتراك جديد: ' + name);
                    }
                })
                .catch(error => {
                    showToast('حدث خطأ أثناء إضافة العضو: ' + error.message, 'error');
                })
                .finally(() => {
                    submitBtn.innerHTML = '<i class="fas fa-save"></i> حفظ العضو';
                    submitBtn.disabled = false;
                });
            }
        });

        // إضافة ربح يومي
        dailyProfitForm.addEventListener('submit', function(e) {
            e.preventDefault();
            
            const date = dailyProfitDate.value;
            const amount = parseFloat(dailyProfitAmount.value);
            const source = dailyProfitSource.value.trim() || 'غير محدد';
            const notes = dailyProfitNotes.value.trim();
            
            if (!date || isNaN(amount) || amount <= 0) {
                showToast('الرجاء إدخال تاريخ ومبلغ صحيح', 'error');
                return;
            }
            
            submitDailyProfitBtn.innerHTML = '<div class="spinner"></div> جاري الحفظ...';
            submitDailyProfitBtn.disabled = true;
            
            const profitData = {
                date: date,
                amount: amount,
                source: source,
                notes: notes,
                createdAt: firebase.database.ServerValue.TIMESTAMP
            };
            
            dailyProfitsRef.push(profitData)
                .then(() => {
                    showToast('تم إضافة الربح اليومي بنجاح');
                    dailyProfitForm.reset();
                    
                    // تعيين تاريخ اليوم كقيمة افتراضية
                    const today = new Date().toISOString().split('T')[0];
                    dailyProfitDate.value = today;
                    
                    // تحديث الربح اليومي
                    updateDailyProfit(amount, source);
                })
                .catch(error => {
                    showToast('حدث خطأ أثناء إضافة الربح اليومي: ' + error.message, 'error');
                })
                .finally(() => {
                    submitDailyProfitBtn.innerHTML = '<i class="fas fa-save"></i> حفظ الربح اليومي';
                    submitDailyProfitBtn.disabled = false;
                });
        });

        // تسجيل المدفوعات
        function recordPayment(memberId, memberName, phone, amount, source, notes) {
            const paymentData = {
                memberId: memberId,
                memberName: memberName,
                phone: phone,
                amount: amount,
                source: source,
                notes: notes || 'لا توجد ملاحظات',
                date: new Date().toISOString().split('T')[0],
                timestamp: firebase.database.ServerValue.TIMESTAMP
            };
            
            paymentsRef.push(paymentData)
                .then(() => {
                    // تحديث إجمالي الأرباح
                    totalProfitAmount += amount;
                    totalProfit.textContent = `${totalProfitAmount} E.G`;
                })
                .catch(error => {
                    console.error('Error recording payment:', error);
                });
        }

        // تحديث الربح اليومي
        function updateDailyProfit(amount, source) {
            const today = new Date().toISOString().split('T')[0];
            
            dailyProfitTotal += amount;
            dailyProfitEl.textContent = `${dailyProfitTotal} E.G`;
            
            // تحديث إجمالي الأرباح
            totalProfitAmount += amount;
            totalProfit.textContent = `${totalProfitAmount} E.G`;
        }

        // حساب الربح اليومي من البيانات
        function calculateDailyProfit() {
            const today = new Date().toISOString().split('T')[0];
            let todayProfit = 0;
            
            // حساب الأرباح من المدفوعات اليومية
            dailyProfits.forEach(profit => {
                if (profit.date === today) {
                    todayProfit += profit.amount;
                }
            });
            
            // حساب الأرباح من المشتركين الجدد اليوم
            allMembers.forEach(member => {
                const memberDate = new Date(member.startDate).toISOString().split('T')[0];
                if (memberDate === today && member.amountPaid > 0) {
                    todayProfit += member.amountPaid;
                }
            });
            
            dailyProfitTotal = todayProfit;
            dailyProfitEl.textContent = `${dailyProfitTotal} E.G`;
        }

        // حساب إجمالي الأرباح من البيانات
        function calculateTotalProfit() {
            let total = 0;
            
            // حساب من المدفوعات
            allPayments.forEach(payment => {
                total += payment.amount;
            });
            
            // حساب من الأرباح اليومية
            dailyProfits.forEach(profit => {
                total += profit.amount;
            });
            
            totalProfitAmount = total;
            totalProfit.textContent = `${totalProfitAmount} E.G`;
        }

        // إلغاء التعديل
        cancelEditBtn.addEventListener('click', cancelEdit);

        function cancelEdit() {
            isEditMode = false;
            currentMemberId = null;
            submitBtn.innerHTML = '<i class="fas fa-save"></i> حفظ العضو';
            cancelEditDiv.style.display = 'none';
            resetForm();
            showToast('تم إلغاء التعديل');
        }

        // إعادة تعيين النموذج
        function resetForm() {
            memberForm.reset();
            memberIdInput.value = '';
            
            const today = new Date().toISOString().split('T')[0];
            startDateInput.value = today;
            
            document.getElementById('paymentStatus').value = 'paid';
            calculateEndDate();
        }

        // تعديل عضو
        function editMember(memberId) {
            membersRef.child(memberId).once('value')
                .then(snapshot => {
                    const member = snapshot.val();
                    if (!member) return;
                    
                    memberIdInput.value = memberId;
                    document.getElementById('memberName').value = member.name;
                    document.getElementById('phoneNumber').value = member.phone;
                    
                    const startDate = new Date(member.startDate);
                    const endDate = new Date(member.endDate);
                    const monthsDiff = (endDate.getFullYear() - startDate.getFullYear()) * 12 + 
                                      (endDate.getMonth() - startDate.getMonth());
                    
                    subscriptionMonths.value = monthsDiff;
                    startDateInput.value = member.startDate;
                    endDateInput.value = member.endDate;
                    subscriptionFeeInput.value = member.subscriptionFee;
                    document.getElementById('amountPaid').value = member.amountPaid;
                    document.getElementById('paymentStatus').value = member.paymentStatus;
                    document.getElementById('notes').value = member.notes || '';
                    
                    isEditMode = true;
                    currentMemberId = memberId;
                    submitBtn.innerHTML = '<i class="fas fa-save"></i> حفظ التعديلات';
                    cancelEditDiv.style.display = 'block';
                    
                    if (!addMemberSection.classList.contains('active')) {
                        addMemberSection.classList.add('active');
                        toggleFormBtn.innerHTML = '<i class="fas fa-times"></i> إغلاق النموذج';
                    }
                    
                    addMemberSection.scrollIntoView({ behavior: 'smooth' });
                })
                .catch(error => {
                    showToast('حدث خطأ أثناء تحميل بيانات العضو: ' + error.message, 'error');
                });
        }

        // حذف عضو
        function deleteMember(memberId) {
            if (confirm('هل أنت متأكد من حذف هذا العضو؟ لا يمكن التراجع عن هذه العملية.')) {
                membersRef.child(memberId).remove()
                    .then(() => {
                        showToast('تم حذف العضو بنجاح');
                        
                        if (isEditMode && currentMemberId === memberId) {
                            cancelEdit();
                        }
                    })
                    .catch(error => {
                        showToast('حدث خطأ أثناء حذف العضو: ' + error.message, 'error');
                    });
            }
        }

        // تجديد الاشتراك
        function renewSubscription(memberId) {
            membersRef.child(memberId).once('value')
                .then(snapshot => {
                    const member = snapshot.val();
                    if (!member) return;
                    
                    const endDate = new Date(member.endDate);
                    const today = new Date();
                    
                    const newEndDate = endDate < today 
                        ? new Date(today.setMonth(today.getMonth() + 1))
                        : new Date(endDate.setMonth(endDate.getMonth() + 1));
                    
                    const remainingAmount = member.subscriptionFee - member.amountPaid;
                    
                    const updateData = {
                        endDate: newEndDate.toISOString().split('T')[0],
                        updatedAt: firebase.database.ServerValue.TIMESTAMP
                    };
                    
                    if (remainingAmount > 0) {
                        if (confirm(`هناك مبلغ ${remainingAmount} E.G متبقٍ. هل تريد إضافته للفاتورة الجديدة؟`)) {
                            updateData.subscriptionFee = member.subscriptionFee + remainingAmount;
                        }
                    }
                    
                    return membersRef.child(memberId).update(updateData);
                })
                .then(() => {
                    showToast('تم تجديد الاشتراك بنجاح لمدة شهر إضافي');
                })
                .catch(error => {
                    showToast('حدث خطأ أثناء تجديد الاشتراك: ' + error.message, 'error');
                });
        }

        // تبديل بين التبويبات
        tabs.forEach(tab => {
            tab.addEventListener('click', function() {
                const tabId = this.dataset.tab;
                
                tabs.forEach(t => t.classList.remove('active'));
                this.classList.add('active');
                
                tabContents.forEach(content => content.classList.remove('active'));
                document.getElementById(`${tabId}-members`).classList.add('active');
            });
        });

        // تنسيق التاريخ
        function formatDate(dateString) {
            const date = new Date(dateString);
            if (isNaN(date.getTime())) return 'غير محدد';
            
            const options = { year: 'numeric', month: 'long', day: 'numeric' };
            return date.toLocaleDateString('ar-EG', options);
        }

        // البحث عن المشتركين
        function searchMembers(query) {
            const normalizedQuery = query.toLowerCase().trim();
            
            if (!normalizedQuery) {
                renderMembers(allMembers);
                return;
            }
            
            const filteredMembers = allMembers.filter(member => {
                return (
                    member.name.toLowerCase().includes(normalizedQuery) ||
                    member.phone.includes(normalizedQuery)
                );
            });
            
            renderMembers(filteredMembers);
        }

        // عرض المشتركين في الجداول
        function renderMembers(members) {
            membersList.innerHTML = '';
            activeMembersList.innerHTML = '';
            expiredMembersList.innerHTML = '';
            
            let activeCount = 0;
            let expiredCount = 0;
            const today = new Date();
            
            members.forEach(member => {
                const remainingAmount = member.subscriptionFee - member.amountPaid;
                const isPaid = member.paymentStatus === 'paid';
                const statusClass = isPaid ? 'status-paid' : 'status-unpaid';
                const statusIcon = isPaid ? 'fa-check-circle' : 'fa-times-circle';
                const amountClass = remainingAmount > 0 ? 'amount-due' : 'amount-remaining';
                const amountText = remainingAmount > 0 ? 
                    `${Math.abs(remainingAmount)} E.G (متبقي)` : 
                    `${Math.abs(remainingAmount)} E.G (زيادة)`;
                
                const endDate = new Date(member.endDate);
                const isActive = endDate >= today;
                const subscriptionStatusClass = isActive ? 'status-active' : 'status-expired';
                const subscriptionStatusIcon = isActive ? 'fa-check-circle' : 'fa-exclamation-circle';
                const subscriptionStatusText = isActive ? 'نشط' : 'منتهي';
                
                if (isActive) activeCount++;
                else expiredCount++;
                
                const row = document.createElement('tr');
                row.className = isActive ? 'active-member' : 'expired-member';
                row.innerHTML = `
                    <td><div class="member-name">${member.name}</div></td>
                    <td>${member.phone}</td>
                    <td>${formatDate(member.startDate)}</td>
                    <td>${formatDate(member.endDate)}</td>
                    <td>
                        <span class="status ${subscriptionStatusClass}">
                            ${subscriptionStatusText}
                            <i class="fas ${subscriptionStatusIcon} status-icon"></i>
                        </span>
                    </td>
                    <td>
                        <span class="status ${statusClass}">
                            ${isPaid ? 'مسدد' : 'غير مسدد'}
                            <i class="fas ${statusIcon} status-icon"></i>
                        </span>
                    </td>
                    <td class="amount">${member.amountPaid} E.G</td>
                    <td class="amount ${amountClass}">${amountText}</td>
                    <td>
                        <div class="action-buttons">
                            <button class="btn btn-sm" onclick="editMember('${member.id}')" title="تعديل">
                                <i class="fas fa-edit"></i>
                            </button>
                            <button class="btn btn-sm btn-danger" onclick="deleteMember('${member.id}')" title="حذف">
                                <i class="fas fa-trash"></i>
                            </button>
                            ${!isActive ? `<button class="btn btn-sm btn-success" onclick="renewSubscription('${member.id}')" title="تجديد">
                                <i class="fas fa-sync-alt"></i>
                            </button>` : ''}
                            ${member.notes ? `<button class="btn btn-sm btn-profit" onclick="showNotes('${member.id}')" title="عرض الملاحظات">
                                <i class="fas fa-sticky-note"></i>
                            </button>` : ''}
                        </div>
                    </td>
                `;
                
                membersList.appendChild(row);
                
                if (isActive) {
                    const activeRow = document.createElement('tr');
                    activeRow.className = 'active-member';
                    activeRow.innerHTML = `
                        <td><div class="member-name">${member.name}</div></td>
                        <td>${member.phone}</td>
                        <td>${formatDate(member.startDate)}</td>
                        <td>${formatDate(member.endDate)}</td>
                        <td>
                            <span class="status ${statusClass}">
                                ${isPaid ? 'مسدد' : 'غير مسدد'}
                                <i class="fas ${statusIcon} status-icon"></i>
                            </span>
                        </td>
                        <td class="amount">${member.amountPaid} E.G</td>
                        <td class="amount ${amountClass}">${amountText}</td>
                        <td>
                            <div class="action-buttons">
                                <button class="btn btn-sm" onclick="editMember('${member.id}')" title="تعديل">
                                    <i class="fas fa-edit"></i>
                                </button>
                                <button class="btn btn-sm btn-danger" onclick="deleteMember('${member.id}')" title="حذف">
                                    <i class="fas fa-trash"></i>
                                </button>
                                ${member.notes ? `<button class="btn btn-sm btn-profit" onclick="showNotes('${member.id}')" title="عرض الملاحظات">
                                    <i class="fas fa-sticky-note"></i>
                                </button>` : ''}
                            </div>
                        </td>
                    `;
                    
                    activeMembersList.appendChild(activeRow);
                }
                else {
                    const expiredRow = document.createElement('tr');
                    expiredRow.className = 'expired-member';
                    expiredRow.innerHTML = `
                        <td><div class="member-name">${member.name}</div></td>
                        <td>${member.phone}</td>
                        <td>${formatDate(member.startDate)}</td>
                        <td>${formatDate(member.endDate)}</td>
                        <td>
                            <span class="status ${statusClass}">
                                ${isPaid ? 'مسدد' : 'غير مسدد'}
                                <i class="fas ${statusIcon} status-icon"></i>
                            </span>
                        </td>
                        <td class="amount">${member.amountPaid} E.G</td>
                        <td class="amount ${amountClass}">${amountText}</td>
                        <td>
                            <div class="action-buttons">
                                <button class="btn btn-sm btn-success" onclick="renewSubscription('${member.id}')" title="تجديد">
                                    <i class="fas fa-sync-alt"></i>
                                </button>
                                <button class="btn btn-sm" onclick="editMember('${member.id}')" title="تعديل">
                                    <i class="fas fa-edit"></i>
                                </button>
                                <button class="btn btn-sm btn-danger" onclick="deleteMember('${member.id}')" title="حذف">
                                    <i class="fas fa-trash"></i>
                                </button>
                                ${member.notes ? `<button class="btn btn-sm btn-profit" onclick="showNotes('${member.id}')" title="عرض الملاحظات">
                                    <i class="fas fa-sticky-note"></i>
                                </button>` : ''}
                            </div>
                        </td>
                    `;
                    
                    expiredMembersList.appendChild(expiredRow);
                }
            });
            
            activeMembersCount.textContent = activeCount;
            expiredMembersCount.textContent = expiredCount;
        }

        // عرض المدفوعات
        function renderPayments() {
            paymentsList.innerHTML = '';
            
            allPayments.forEach(payment => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${payment.memberName}</td>
                    <td>${payment.phone}</td>
                    <td>${formatDate(payment.date)}</td>
                    <td class="amount">${payment.amount} E.G</td>
                    <td>
                        <span class="status status-paid">
                            مسدد
                            <i class="fas fa-check-circle status-icon"></i>
                        </span>
                    </td>
                    <td>${payment.notes}</td>
                `;
                paymentsList.appendChild(row);
            });
        }

        // عرض ملاحظات المشترك
        function showNotes(memberId) {
            const member = allMembers.find(m => m.id === memberId);
            if (!member || !member.notes) return;
            
            alert(`ملاحظات عن المشترك ${member.name}:\n\n${member.notes}`);
        }

        // إنشاء نسخة احتياطية
        function createBackup() {
            const today = new Date();
            const backupDate = today.toISOString();
            const backupData = {
                members: allMembers,
                payments: allPayments,
                dailyProfits: dailyProfits,
                createdAt: backupDate
            };
            
            // حفظ نسخة في localStorage
            localStorage.setItem('gymMembersBackup', JSON.stringify(backupData));
            
            // حفظ نسخة في Firebase
            backupRef.push(backupData)
                .then(() => {
                    showToast('تم إنشاء نسخة احتياطية بنجاح');
                })
                .catch(error => {
                    showToast('حدث خطأ أثناء إنشاء النسخة الاحتياطية: ' + error.message, 'error');
                });
        }

        // استعادة النسخة الاحتياطية من localStorage
        function restoreFromLocalBackup() {
            const backup = localStorage.getItem('gymMembersBackup');
            if (!backup) return;
            
            try {
                const backupData = JSON.parse(backup);
                allMembers = backupData.members || [];
                allPayments = backupData.payments || [];
                dailyProfits = backupData.dailyProfits || [];
                
                renderMembers(allMembers);
                renderPayments();
                calculateTotalProfit();
                calculateDailyProfit();
                
                showToast('تم تحميل النسخة الاحتياطية المحلية');
            } catch (error) {
                console.error('Error restoring from local backup:', error);
            }
        }

        // إعادة حساب جميع الأموال
        function recalculateAllPayments() {
            if (confirm('هل تريد إعادة حساب جميع الأموال المحصلة؟ سيتم تحديث الإحصائيات بناءً على البيانات الحالية.')) {
                calculateTotalProfit();
                calculateDailyProfit();
                showToast('تم إعادة حساب جميع الأموال بنجاح');
            }
        }

        // حذف جميع سجلات المدفوعات
        function clearAllPayments() {
            if (confirm('هل أنت متأكد من حذف جميع سجلات المدفوعات؟ لا يمكن التراجع عن هذه العملية.')) {
                paymentsRef.remove()
                    .then(() => {
                        allPayments = [];
                        totalProfitAmount = 0;
                        totalProfit.textContent = '0 E.G';
                        renderPayments();
                        showToast('تم حذف جميع سجلات المدفوعات بنجاح');
                    })
                    .catch(error => {
                        showToast('حدث خطأ أثناء حذف سجلات المدفوعات: ' + error.message, 'error');
                    });
            }
        }

        // تحديث قوائم المشتركين عند تغيير البيانات في Firebase
        membersRef.on('value', function(snapshot) {
            allMembers = [];
            
            snapshot.forEach(childSnapshot => {
                const member = childSnapshot.val();
                member.id = childSnapshot.key;
                allMembers.push(member);
            });
            
            renderMembers(allMembers);
        });

        // تحديث المدفوعات عند تغيير البيانات في Firebase
        paymentsRef.on('value', function(snapshot) {
            allPayments = [];
            
            snapshot.forEach(childSnapshot => {
                const payment = childSnapshot.val();
                payment.id = childSnapshot.key;
                allPayments.push(payment);
            });
            
            renderPayments();
            calculateTotalProfit();
        });

        // تحديث الأرباح اليومية
        dailyProfitsRef.on('value', function(snapshot) {
            dailyProfits = [];
            
            snapshot.forEach(childSnapshot => {
                const profit = childSnapshot.val();
                profit.id = childSnapshot.key;
                dailyProfits.push(profit);
            });
            
            calculateDailyProfit();
            calculateTotalProfit();
        });

        // البحث عند كتابة نص في صندوق البحث
        searchInput.addEventListener('input', function() {
            searchMembers(this.value);
        });

        // إنشاء نسخة احتياطية عند النقر على الزر
        backupBtn.addEventListener('click', createBackup);

        // إعادة حساب الأموال
        recalculateBtn.addEventListener('click', recalculateAllPayments);

        // حذف جميع المدفوعات
        clearPaymentsBtn.addEventListener('click', clearAllPayments);

        // التحميل الأولي للصفحة
        document.addEventListener('DOMContentLoaded', function() {
            resetForm();
            
            const today = new Date().toISOString().split('T')[0];
            startDateInput.value = today;
            dailyProfitDate.value = today;
            calculateEndDate();
            
            // استعادة النسخة الاحتياطية من localStorage إذا وجدت
            restoreFromLocalBackup();
            
            // إنشاء نسخة احتياطية كل ساعة
            backupInterval = setInterval(createBackup, 60 * 60 * 1000);
            
            // مراجعة الربح اليومي كل دقيقة
            profitCheckInterval = setInterval(calculateDailyProfit, 60 * 1000);
            
            // جعل الدوال متاحة للاستدعاء من الأحداث المضمنة في HTML
            window.editMember = editMember;
            window.deleteMember = deleteMember;
            window.renewSubscription = renewSubscription;
            window.showNotes = showNotes;
        });

        // تنظيف الفواصل الزمنية عند إغلاق الصفحة
        window.addEventListener('beforeunload', function() {
            clearInterval(backupInterval);
            clearInterval(profitCheckInterval);
        });
    </script>
</body>
</html>
